{% extends "pricing/base/base_price.html" %}
{% load static %}

{% block page_header %}{% endblock %}

{% block content %}
<div class="price" style="background: none; padding-top: 0;">
    <div class="container">
        <div class="category-filter mb-4 text-center">
            <button class="btn btn-outline-primary mx-1 filter-btn active" data-filter="all">Все категории</button>
            {% for category in categories %}
            <button class="btn btn-outline-primary mx-1 filter-btn" data-filter="category-{{ category.id }}">{{ category.name }}</button>
            {% endfor %}
        </div>

        <div class="row" id="servicesGrid">
            {% for category in categories %}
                {% for service in category.services.all %}
                <div class="col-md-4 col-sm-6 mb-4 price-item category-{{ category.id }} position-relative">
                    <div class="card h-100 shadow-sm rounded-lg border-0 d-flex flex-column align-items-stretch">
                        <div class="card-body d-flex flex-column align-items-center">

                            <h5 class="card-title text-primary font-weight-bold text-center">{{ service.name }}</h5>
                            <p class="card-text text-muted flex-grow-1 text-center">{{ service.description }}</p>
                            <div class="price mb-3 text-danger font-weight-bold h4 text-center">{{ service.price|floatformat:0 }} ₽</div>
                            <form method="post" action="{% url 'cart:add_to_cart' service.id %}" class="add-to-cart-form mt-auto w-100" onsubmit="event.stopImmediatePropagation();">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success btn-block add-to-cart-btn rounded-pill shadow-sm">
                                    <i class="fas fa-shopping-cart mr-2"></i>Добавить в корзину
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% endfor %}
            {% for service in no_category_services %}
            <div class="col-md-4 col-sm-6 mb-4 price-item no-category position-relative">
                <div class="card h-100 shadow-sm rounded-lg border-0 d-flex flex-column align-items-stretch">
                    <div class="card-body d-flex flex-column align-items-center">
                        <div class="service-img mb-3">
                            <img src="{% if service.image %}{{ service.image.url }}{% else %}{% static 'img/default_service.png' %}{% endif %}" alt="{{ service.name }}" class="img-fluid rounded-circle shadow" style="width:90px;height:90px;object-fit:cover;background:#f8f9fa;">
                        </div>
                        <h5 class="card-title text-primary font-weight-bold text-center">{{ service.name }}</h5>
                        <p class="card-text text-muted flex-grow-1 text-center">{{ service.description }}</p>
                        <div class="price mb-3 text-danger font-weight-bold h4 text-center">{{ service.price|floatformat:0 }} ₽</div>
                        <form method="post" action="{% url 'cart:add_to_cart' service.id %}" class="add-to-cart-form mt-auto w-100" onsubmit="event.stopImmediatePropagation();">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success btn-block add-to-cart-btn rounded-pill shadow-sm">
                                <i class="fas fa-shopping-cart mr-2"></i>Добавить в корзину
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Фиксированная иконка корзины -->
<a href="{% url 'cart:view_cart' %}" class="fixed-cart-icon" title="Перейти в корзину">
    <i class="fas fa-shopping-cart"></i>
    {% if cart_count and cart_count > 0 %}
        <span class="cart-count">{{ cart_count }}</span>
    {% endif %}
</a>

{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <link href="{% static 'css/price_uslugi_theme.css' %}" rel="stylesheet">
    <script src="{% static 'js/add_to_cart_effect.js' %}"></script>
    <script src="{% static 'js/price_uslugi_carousel.js' %}"></script>
    <script src="{% static 'js/price_uslugi_filter.js' %}"></script>
{% endblock %}
